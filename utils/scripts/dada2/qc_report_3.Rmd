---
output:
  html_document:
    theme: flatly
    highlight: tango
    toc: yes
    number_sections: yes
    toc_depth: 4
    toc_float:
      collapsed: no
    smooth_scroll: yes
params:
  rmd: "qc_report_part3.Rmd"
  seqtab: ""
  taxonomy: ""
  krona: ""
  path: ""
  length_dist: ""
  out_dir: ""
---



```r needed packages,echo=F, message=F,include=F, warning=F}
suppressMessages(library(ggplot2))
suppressMessages(library(psadd))
suppressMessages(library(phyloseq))

```

```{r needed files, echo=F}
seqtab <- params$seqtab
taxonomy <- params$taxonomy
krona <- params$krona
path<-params$path
length_dist<-params$length_dist
out_dir <-params$out_dir

```

## ASVs length distribution for all samples

<br>

```{r all ASVs length distribution abundance, results='asis', echo=F}

files <- list.files(path = length_dist, pattern = "distribution", full.names =TRUE)


for (f in files) {
   cat(paste0("![](", f, "){width=1000%}\n"))
 }

```

<br>
<br>
<br>
<br>
<br>



## Taxonomy profile

<br>


If no sample profile is displayed, try selecting different samples from the list. To view specific sample profiles in the Krona pl
ot, you need to click on the samples listed on the left. You can also use 
the search box at the top to find specific taxa. Additionally, the Krona plot provides options to adjust the taxonomy depth, font 
size, and chart size to customize your view. Use the '+' and '-' buttons 
next to each option to make these adjustments. If needed, you can also take a snapshot of your current view for reference or shari
ng.

<br>

```{r krona-plot, echo=FALSE,message=F, warning=F}
#Read sequence data and taxonomy data
seqtabs <- data.frame(readRDS(seqtab))
taxa <- read.table(taxonomy, header = TRUE, sep = "\t", check.names = FALSE)

# Prepare the sample data
data <- data.frame(samples = rownames(seqtabs))
rownames(data) <- data$samples


# Create a phyloseq object
ps <- phyloseq(otu_table(as.matrix(seqtabs), taxa_are_rows = FALSE),
               sample_data(data),
               tax_table(as.matrix(taxa)))


ps_genus<- tax_glom(ps, taxrank="Genus")

options(browser = "echo") #plot_krona is set to open the krona plot as a separate html file, this stops it

# Plot Krona chart
a <- psadd::plot_krona(physeq=ps_genus, output=krona, variable="samples", trim = TRUE)

file=paste(path,out_dir, sep = "/")

```

<iframe src="`r paste0(file, "/QC_html_report/krona_Species_result.html")`" width="1100" height="700" scrolling="yes"></iframe>

<div Class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
